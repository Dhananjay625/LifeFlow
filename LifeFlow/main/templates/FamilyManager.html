{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Family - LifeFlow</title>
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'index.css' %}?v=2">
</head>

<body>
  <div class="container">
    <!-- Sidebar -->
    <aside>
      <nav class="nav">
        <ul class="nav-links">
          <li><a href="{% url 'UserProfile' %}"><i class='bx bx-user'></i><span><strong>{{ user.username }}</strong></span></a></li>
          <li><a href="{% url 'TaskManager' %}"><i class='bx bx-grid-alt'></i><span>Task Manager</span></a></li>
          <li><a href="{% url 'calendar' %}"><i class='bx bx-calendar'></i><span>Calendar</span></a></li>
          <li><a href="{% url 'confirm_password' %}"><i class='bx bx-folder'></i><span>Document Manager</span></a></li>
          <li><a href="{% url 'Subscription' %}"><i class='bx bx-cloud-download'></i><span>Subscription Tracker</span></a></li>
          <li><a href="{% url 'BillManager' %}"><i class='bx bx-receipt'></i><span>Bill Manager</span></a></li>
          <li><a href="{% url 'HealthManager' %}"><i class='bx bx-dumbbell'></i><span>Health Manager</span></a></li>
          <li><a href="#" class="active"><i class='bx bx-group'></i><span>Family</span></a></li>
        </ul>

        <div class="collapse-btn">
          <a href="#" data-resize-btn><i class='bx bx-chevrons-right'></i><span>Collapse</span></a>
        </div>

        <div class="logout-btn">
          <a href="{% url 'login' %}"><i class='bx bx-log-out'></i><span>Logout</span></a>
        </div>
      </nav>
    </aside>

    <!-- Main -->
    <main class="content">
      <header class="header">
        <div class="date">{{ date|default:"Monday, December 14, 2025" }}</div>
        <h1>Family</h1>
      </header>

      <!-- TOP ROW: Family Summary (Invite + Switch) | Create / Join -->
      <section class="cards-grid">
        <!-- Family Summary -->
        <div class="card">
          <div class="card-header">
            <h2>{{ family.name|default:"The Rai Family" }}</h2>
            <p class="card-sub">Share tasks, bills, and calendar events together.</p>
          </div>

          <div class="stats">
            <div class="stat">
              <span class="stat-label">Owner</span>
              <span class="stat-value">{{ owner.username|default:user.username }}</span>
            </div>
            <div class="stat">
              <span class="stat-label">Members</span>
              <span class="stat-value">{{ members|length|default:'0' }}</span>
            </div>
            <div class="stat">
              <span class="stat-label">Active Since</span>
              <span class="stat-value">{{ family.created_at|date:"M j, Y"|default:"—" }}</span>
            </div>
          </div>

          <!-- Primary action -->
          <div class="card-actions">
            <a class="btn btn-primary btn-lg" href="#" id="openInviteModal">
              <i class='bx bx-user-plus' style="font-size:1.2rem;vertical-align:-2px"></i>
              Invite Member
            </a>
          </div>

          <!-- Switch Family (no action for now) -->
          <button class="option-btn" type="button" id="toggleSwitch">
            <i class='bx bx-transfer-alt'></i>
            Switch Family
          </button>
        </div>

        <!-- Create / Join -->
        <div class="card">
          <div class="card-header"><h2>Create Family</h2></div>

          <form method="post" action="#" onsubmit="toast('Create: hook backend next');return false;">
            {% csrf_token %}
            <div class="form-group">
              <label for="fam_name">Family Name</label>
              <input id="fam_name" name="name" type="text" placeholder="e.g. The Rai Family">
            </div>
            <div class="form-actions">
              <button class="btn btn-primary btn-lg" type="submit">Create</button>
            </div>
          </form>

          <div style="height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.06),transparent);margin:1.1rem 0 .9rem;"></div>

          <div class="card-header" style="margin-top:.2rem;"><h2 style="font-size:1.05rem;">Join with Invite Code</h2></div>
          <form method="post" action="#" onsubmit="toast('Join: hook backend next');return false;">
            {% csrf_token %}
            <div class="join-row">
              <input type="text" name="invite_code" placeholder="Paste invite code">
              <button class="btn btn-primary btn-pill" type="submit">Join</button>
            </div>
          </form>
        </div>
      </section>

      <!-- Members -->
      <section style="margin-top:1.2rem;">
        <h2 class="title">Members</h2>
        <ul class="task-list">
          {% for m in members %}
          <li class="task-item">
            <span class="status-dot" style="background:#4ECDC4"></span>
            <label style="flex:1;font-size:18px;">
              {{ m.user.get_full_name|default:m.user.username }}
              <span class="date"> • {{ m.role|title }}</span>
            </label>
            <button class="delete-btn" title="Remove" onclick="toast('Remove: hook backend next')">
              <i class='bx bx-user-x'></i>
            </button>
          </li>
          {% empty %}
          <li class="task-item"><label>No members yet. Use “Invite Member”.</label></li>
          {% endfor %}
        </ul>
      </section>

      <!-- Recent Tasks -->
      <section style="margin-top:1.2rem;margin-bottom:2rem;">
        <div style="display:flex;align-items:center;justify-content:space-between;">
          <h2 class="title">Recent Tasks</h2>
        </div>
        <ul class="task-list">
          {% for t in tasks %}
          <li class="task-item">
            <input type="checkbox" {% if t.completed %}checked{% endif %} disabled />
            <label style="flex:1">
              {{ t.title }}
              {% if t.due_date %}<span class="date"> • Due: {{ t.due_date|date:"M j, g:i a" }}</span>{% endif %}
              {% if t.assigned_to %}<span class="date"> • → {{ t.assigned_to.username|default:t.assigned_to }}</span>{% endif %}
              {% if t.priority %}<span class="date"> • {{ t.priority|title }}</span>{% endif %}
            </label>
          </li>
          {% empty %}
          <li class="task-item"><label>No tasks yet.</label></li>
          {% endfor %}
        </ul>
      </section>
    </main>
  </div>

  <!-- Invite Modal -->
  <div id="inviteModal" class="modal">
    <div class="modal-content">
      <h2 style="margin-top:0;color:var(--primary-color);">Invite Member</h2>
      <form method="post" action="#" onsubmit="toast('Invite sent: hook backend next');event.preventDefault();">
        {% csrf_token %}
        <div class="form-group">
          <label for="invite_email">Email</label>
          <input id="invite_email" type="email" name="email" placeholder="person@example.com" required />
        </div>
        <div class="form-group">
          <label for="invite_role">Role</label>
          <select id="invite_role" name="role">
            <option value="parent">Parent</option>
            <option value="child">Child</option>
          </select>
        </div>
        <div class="modal-buttons">
          <button type="button" id="cancelInvite" class="btn btn-ghost">Cancel</button>
          <button type="submit" class="btn btn-primary">Send Invite</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // sidebar collapse
    const resizeBtn = document.querySelector("[data-resize-btn]");
    resizeBtn?.addEventListener("click", (e) => { e.preventDefault(); document.body.classList.toggle("sb-expanded"); });

    // toast
    window.toast = (msg) => alert(msg);

    // invite modal
    const modal = document.getElementById('inviteModal');
    document.getElementById('openInviteModal')?.addEventListener('click', (e) => { e.preventDefault(); modal.style.display='block'; });
    document.getElementById('cancelInvite')?.addEventListener('click', () => modal.style.display='none');
    window.addEventListener('click', (e) => { if (e.target === modal) modal.style.display='none'; });

    // Switch Family: intentionally no action for now
    document.getElementById('toggleSwitch')?.addEventListener('click', (e)=>{ e.preventDefault(); /* no-op for now */ });
  </script>
</body>
</html>
