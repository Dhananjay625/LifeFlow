{% extends 'appboard/base.html' %}
{% load static %}

{% block extra_head %}
<style>
 /* ===============================
   STORE PAGE â€“ FIXED CART LAYOUT
   =============================== */

   .store-page {
    color: var(--text-light);
    display: flex;
    flex-direction: column;
    height: 100vh;             /* full viewport */
    overflow: hidden;          /* prevent double scroll */
  }
  
  .store-page .container-fluid {
    flex: 1;
    display: grid;
    grid-template-columns: 1fr 2fr 1fr; /* left filters, products, cart */
    gap: 1rem;
    height: 100%;
    padding-right: 1rem;
  }
  
  /* Left filters scroll with page but stay tidy */
  .store-page .filter-card {
    position: sticky;
    top: 20px;
    align-self: start;
  }
  
  /* ====================
     FIXED CART SECTION
     ==================== */
  .fixed-cart {
    position: fixed;
    top: 64px;             /* adjust for your navbar height if needed */
    right: 2rem;
    width: 22%;
    height: calc(100vh - 80px);
    display: flex;
    flex-direction: column;
  }
  
  .fixed-cart .card-body {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  
  #shopping-cart-container {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    padding: 1rem;
    max-height: none;
  }
  
  /* Product column scrolls only */
  .main-scroll {
    overflow-y: auto;
    height: calc(100vh - 80px);
    padding-right: 0.5rem;
  }
  
  /* General card styling */
  .store-page .card {
    background: var(--background-light);
    border: 1px solid rgba(255, 255, 255, 0.06);
    border-radius: 14px;
    box-shadow: 0 10px 24px rgba(0, 0, 0, 0.35);
  }
  
  .store-page .card-header {
    background: #1b1b1b;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    color: var(--text-light);
  }
  
  /* Product cards */
  .store-page .product-deck {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
  }
  
  .store-page .product-card {
    width: 22rem;
    min-height: 560px;
    display: flex;
    flex-direction: column;
  }
  
  .store-page .product-card .card-img-top {
    height: 260px;
    object-fit: cover;
    background: #2b2f39;
  }
  
  /* Typography */
  .store-page .product-title {
    font-size: 1.15rem;
    margin: 0 0 .25rem;
  }
  .store-page .product-desc {
    color: var(--text-muted);
    font-size: .95rem;
    max-height: 4.6em;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 4;
    -webkit-box-orient: vertical;
  }
  
  /* Cart footer and buttons */
  .cart-footer {
    background: #1b1b1b;
    border-top: 1px solid rgba(255, 255, 255, .08);
    border-radius: 0 0 14px 14px;
  }
  
  .cart-footer .btn {
    border-radius: 12px;
  }
  
  /* Scrollbars (optional aesthetic) */
  .main-scroll::-webkit-scrollbar,
  #shopping-cart-container::-webkit-scrollbar {
    width: 8px;
  }
  .main-scroll::-webkit-scrollbar-thumb,
  #shopping-cart-container::-webkit-scrollbar-thumb {
    background-color: rgba(255, 255, 255, 0.2);
    border-radius: 4px;
  }
  
  /* Responsive */
  @media (max-width: 1200px) {
    .fixed-cart {
      position: static;
      width: 100%;
      height: auto;
    }
    .main-scroll {
      overflow: visible;
      height: auto;
    }
  }
  /* =====================
   ONE-LINE PRODUCT SCROLL
   ===================== */
.main-scroll {
    overflow-x: auto;        /* allow horizontal scroll */
    overflow-y: hidden;
    white-space: nowrap;     /* keep cards in one row */
    scroll-behavior: smooth;
    padding-bottom: 1rem;
  }
  
  .product-deck {
    display: inline-flex;    /* makes them line up horizontally */
    flex-wrap: nowrap;
    gap: 1rem;               /* space between cards */
  }
  
  .product-card {
    width: 18rem;            /* consistent width for each card */
    flex: 0 0 auto;          /* prevent shrinking */
    display: inline-block;
  }
  /* Scope to this page only */
  .product-detail .thumbnail-hero{
    width:100%; height:auto; display:block; border-radius:12px; object-fit:cover;
  }

  .product-detail .similar-wrap{
    border-radius:12px; padding:12px;
    
  }
  .product-detail .similar-list{
    display:flex; flex-direction:column; gap:10px;
    max-height:68vh; overflow:auto; padding-right:2px;
  }
  .product-detail .similar-item{
    display:flex; gap:10px; align-items:center; text-decoration:none;
    border-radius:10px; padding:10px; color:inherit;
  }
  
  .product-detail .similar-thumb{
    width:96px; height:68px; flex:0 0 96px;
    object-fit:cover; border-radius:8px; display:block;
  }
  .product-detail .similar-meta{ min-width:0; }
  .product-detail .truncate{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
</style>
{% endblock %}

{% block content %}
<div class="product-detail">

  <a href="{% url 'store:store' %}" class="mr-2" style="margin-bottom:20px; display:inline-block;">
    <img src="{% static 'store/images/return_icon.png' %}" alt="Return Icon" style="width:30px;height:30px;">
  </a>

  <div class="row">
    <!-- Main panel -->
    <div class="col-md-9">
      <div class="row">
        <div class="col-lg-5 col-md-4 col-sm-4">
          {% if product.image_name %}
            <img class="thumbnail-hero"
                 src="{% static 'store/images/' %}{{ product.image_name }}_640x360.png"
                 alt="{{ product.name }}">
          {% else %}
            <img class="thumbnail-hero" src="{% static 'store/images/placeholder.png' %}" alt="Placeholder Image">
          {% endif %}
        </div>

        <div class="col-lg-7 col-md-8 col-sm-8">
          <h4 class="mt-3">{{ product.name }}</h4>
          <h4 class="mt-1"><span style="border-bottom:1px solid grey;">${{ product.current_price }}</span></h4>

          <button data-product="{{ product.pk }}" data-action="add"
                  class="mr-1 btn btn-outline-secondary add-btn update-cart">
            Add to Cart
          </button>
        </div>
      </div>

      <div class="row mt-5">
        <div class="col-md-8">
          <div>
            <h4>Product Description:</h4>
            <p class="p-3">{{ product.long_description }}</p>
          </div>
        </div>
      </div>

      <div class="row mt-1">
        <div class="col-md-12">
          <div>
          
            <p class="p-3">
              <iframe width="420" height="315" src=""></iframe>
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Right rail -->
    <div class="col-md-3">
      <div class="similar-wrap">
        <h4 class="mt-2 mb-2">Similar Products</h4>
        <div class="similar-list">
          {% for similar_product in similar_products %}
            <a href="{% url 'store:product_detail' pk=similar_product.pk %}" class="similar-item">
              {% if similar_product.image_name %}
                <img class="similar-thumb"
                     src="{% static 'store/images/' %}{{ similar_product.image_name }}_640x360.png"
                     alt="{{ similar_product.name }}">
              {% else %}
                <img class="similar-thumb" src="{% static 'store/images/placeholder.png' %}" alt="">
              {% endif %}
              <div class="similar-meta">
                <div class="truncate" style="font-weight:700">{{ similar_product.name }}</div>
                <small class="text-muted">${{ similar_product.current_price }}</small>
              </div>
            </a>
          {% empty %}
            <div class="text-muted">No similar products found.</div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>

</div>
{% endblock content %}
