{% load static %}

<link rel="stylesheet" type="text/css" href="{% static 'appboard/css/sidebar.css' %}" />

<div id="sidebar" class="sidebar">
  <nav class="sticky-top position-sticky">
    <ul class="navbar-nav flex-column text-ofx-light px-3">

      <!-- Logo -->
      <li class="nav-item py-3 text-center">
        <img class="img-profile" src="{% static 'appboard/images/logo/GeoDesk.Ai_logo-with_text.png' %}">
      </li>

      <hr class="text-ofx-gray my-2">

      <!-- My Apps -->
      <li class="side-menu-item">
        <a href="#" class="side-main-btn" data-toggle="submenu" data-target="#my_apps">
          <i class="fa-solid fa-computer fa-2x"></i><br>
          My Apps
        </a>

        <ul class="side-menu-sub-item" id="my_apps">
          {% if subscriptions and subscriptions|length > 0 %}
            {% for subscription in subscriptions %}
              {% if subscription.status == "PAUSED" %}
                <li>
                  <div class="pause-sub cursor-pointer btn text-ofx-red"
                       data-toggle="modal" data-target="#subPauseModal" style="cursor:pointer">
                    {{ subscription.application.name }}
                  </div>
                </li>
              {% else %}
                <li>
                  <a href="{{ subscription.application.app_url }}">{{ subscription.application.name }}</a>
                </li>
              {% endif %}
            {% endfor %}
          {% else %}
            <li>
              <center>
                <div style="color: rgba(255, 255, 255, 0.5); margin: 1rem 0;">
                  You have not subscribed to any app yet.
                </div>
              </center>
            </li>
          {% endif %}
        </ul>
      </li>

      <!-- LifeFlow (links to your Django pages) -->
      <li class="side-menu-item">
        <a href="#" class="side-main-btn" data-toggle="submenu" data-target="#lifeflow_menu">
          <i class="fa-solid fa-layer-group fa-2x"></i><br>
          LifeFlow
        </a>

        <ul class="side-menu-sub-item" id="lifeflow_menu">
          <li>
            <a href="{% url 'calendar' %}"
               class="{% if request.resolver_match.url_name == 'calendar' %}active{% endif %}">
              Calendar
            </a>
          </li>
          <li>
            <a href="{% url 'confirm_password' %}">Document Manager</a>
          </li>
          <li>
            <a href="{% url 'Subscription' %}"
               class="{% if request.resolver_match.url_name == 'Subscription' %}active{% endif %}">
              Subscription Tracker
            </a>
          </li>
          <li>
            <a href="{% url 'BillManager' %}"
               class="{% if request.resolver_match.url_name == 'BillManager' %}active{% endif %}">
              Bill Manager
            </a>
          </li>
          <li>
            <a href="{% url 'HealthManager' %}"
               class="{% if request.resolver_match.url_name == 'HealthManager' %}active{% endif %}">
              Health Manager
            </a>
          </li>
          <li><a href="#">Family</a></li>
          <li><a href="http://127.0.0.1:8000" target="_blank" rel="noopener">GeoDesk</a></li>
        </ul>
      </li>

      <!-- Project Menu -->
      <li class="side-menu-item">
        <a href="#" class="side-main-btn" data-toggle="submenu" data-target="#project_menu">
          <i class="fa-solid fa-users-line fa-2x"></i><br>
          Project Menu
        </a>

        <ul class="side-menu-sub-item" id="project_menu">
          <li>
            <a href="{% url 'dashboard' %}?tab=nav-projects-tab&tabContent=nav-projects">My Projects</a>
          </li>
          <li>
            <a href="{% url 'dashboard' %}?tab=nav-tenements-tab&tabContent=nav-tenements">My Tenements</a>
          </li>
          <li><a href="#">Knowledge Management System</a></li>
          <li><a href="#">Landowner Management System</a></li>
          <li><a href="#">Data Catalogue</a></li>
        </ul>
      </li>

      <!-- Regional Menu -->
      <li class="side-menu-item">
        <a href="#" class="side-main-btn" data-toggle="submenu" data-target="#regional_menu">
          <i class="fa-solid fa-map-location-dot fa-2x"></i><br>
          Regional Menu
        </a>

        <ul class="side-menu-sub-item" id="regional_menu">
          <li><a href="#">Queensland Tenure Monitoring Map</a></li>
          <li><a href="https://georesglobe.information.qld.gov.au/" target="_blank" rel="noopener">GeoRes Globe</a></li>
          <li><a href="https://qldglobe.information.qld.gov.au/" target="_blank" rel="noopener">Queensland Globe</a></li>
          <li><a href="https://geoscience.data.qld.gov.au/" target="_blank" rel="noopener">GSQ Open Data Portal</a></li>
          <li><a href="https://qldspatial.information.qld.gov.au/catalogue/" target="_blank" rel="noopener">Queensland Spatial Catalogue</a></li>
        </ul>
      </li>

      <hr class="text-ofx-gray my-3">

      <!-- Logout -->
      <li class="nav-item py-3">
        <a href="{% url 'login' %}" class="btn btn-sm btn-outline-light w-100">
          <i class="bx bx-log-out"></i> Logout
        </a>
      </li>
    </ul>
  </nav>
</div>

<script>
  // simple accordion toggle for the sidebar
  document.querySelectorAll('.side-main-btn[data-toggle="submenu"]').forEach(btn => {
    btn.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.dataset.target);
      if (target) target.classList.toggle('open');
    });
  });

  // optional: collapse/expand with your previous data-resize-btn
  document.querySelectorAll('[data-resize-btn]').forEach(b=>{
    b.addEventListener('click', e=>{
      e.preventDefault();
      document.body.classList.toggle('sb-expanded');
    });
  });
</script>